<Window x:Class="MSCC.Views.ScriptEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Script Editor" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterOwner">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        
        <Style x:Key="ToolbarButton" TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="MinWidth" Value="70"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="150"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Toolbar -->
        <ToolBar Grid.Row="0" Background="#F0F0F0">
            <Button Content="Speichern" 
                    Command="{Binding SaveCommand}"
                    Style="{StaticResource ToolbarButton}"/>
            <Separator/>
            <Button Content="Kompilieren" 
                    Command="{Binding CompileCommand}"
                    Background="#27AE60"
                    Foreground="White"
                    Style="{StaticResource ToolbarButton}"/>
            <Button Content="Validieren" 
                    Command="{Binding ValidateCommand}"
                    Style="{StaticResource ToolbarButton}"/>
            <Separator/>
            <Menu Background="Transparent">
                <MenuItem Header="Einfuegen">
                    <MenuItem Header="Suchergebnis erstellen" 
                              Command="{Binding InsertTemplateCommand}" 
                              CommandParameter="search"/>
                    <MenuItem Header="Aktion hinzufuegen" 
                              Command="{Binding InsertTemplateCommand}" 
                              CommandParameter="action"/>
                    <MenuItem Header="Konfigurationsparameter" 
                              Command="{Binding InsertTemplateCommand}" 
                              CommandParameter="config"/>
                    <MenuItem Header="Detailansicht" 
                              Command="{Binding InsertTemplateCommand}" 
                              CommandParameter="detailview"/>
                </MenuItem>
            </Menu>
            <Separator/>
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                <TextBlock Text="Script: " VerticalAlignment="Center"/>
                <TextBlock Text="{Binding ScriptName}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <TextBlock Text=" *" Foreground="Red" VerticalAlignment="Center"
                           Visibility="{Binding HasUnsavedChanges, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>
        </ToolBar>
        
        <!-- Script-Info -->
        <Border Grid.Row="1" Background="#E8F4FD" Padding="8" 
                Visibility="{Binding HasScript, Converter={StaticResource BoolToVis}}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Version: " FontWeight="SemiBold"/>
                <TextBlock Text="{Binding CurrentScript.Metadata.Version}" Margin="0,0,16,0"/>
                <TextBlock Text="Erstellt: " FontWeight="SemiBold"/>
                <TextBlock Text="{Binding CurrentScript.Metadata.CreatedAt, StringFormat=g}" Margin="0,0,16,0"/>
                <TextBlock Text="Geaendert: " FontWeight="SemiBold"/>
                <TextBlock Text="{Binding CurrentScript.Metadata.ModifiedAt, StringFormat=g}"/>
            </StackPanel>
        </Border>
        
        <!-- Code Editor (Simple TextBox) -->
        <Border Grid.Row="2" BorderBrush="#E0E0E0" BorderThickness="1" Margin="4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="50"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Line Numbers -->
                <Border Grid.Column="0" Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
                    <TextBlock x:Name="LineNumbers" 
                               FontFamily="Consolas" FontSize="14"
                               Foreground="#888" Padding="4,4,8,4"
                               TextAlignment="Right"/>
                </Border>
                
                <!-- Code TextBox -->
                <TextBox x:Name="CodeEditor"
                         Grid.Column="1"
                         FontFamily="Consolas"
                         FontSize="14"
                         AcceptsReturn="True"
                         AcceptsTab="True"
                         TextWrapping="NoWrap"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Auto"
                         BorderThickness="0"
                         Padding="4"/>
            </Grid>
        </Border>
        
        <!-- Splitter -->
        <GridSplitter Grid.Row="3" Height="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>
        
        <!-- Fehler/Warnungen -->
        <TabControl Grid.Row="4" Margin="4">
            <TabItem Header="Fehler">
                <ListView ItemsSource="{Binding Errors}" 
                          SelectionChanged="ErrorList_SelectionChanged">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Zeile" Width="60" 
                                            DisplayMemberBinding="{Binding Line}"/>
                            <GridViewColumn Header="Spalte" Width="60" 
                                            DisplayMemberBinding="{Binding Column}"/>
                            <GridViewColumn Header="Code" Width="80" 
                                            DisplayMemberBinding="{Binding ErrorId}"/>
                            <GridViewColumn Header="Meldung" Width="500" 
                                            DisplayMemberBinding="{Binding Message}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </TabItem>
            <TabItem Header="Warnungen">
                <ListView ItemsSource="{Binding Warnings}"
                          SelectionChanged="ErrorList_SelectionChanged">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Zeile" Width="60" 
                                            DisplayMemberBinding="{Binding Line}"/>
                            <GridViewColumn Header="Spalte" Width="60" 
                                            DisplayMemberBinding="{Binding Column}"/>
                            <GridViewColumn Header="Code" Width="80" 
                                            DisplayMemberBinding="{Binding ErrorId}"/>
                            <GridViewColumn Header="Meldung" Width="500" 
                                            DisplayMemberBinding="{Binding Message}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </TabItem>
        </TabControl>
        
        <!-- Statusleiste -->
        <Border Grid.Row="5" Background="#2C3E50" Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="{Binding StatusMessage}" 
                           Foreground="White"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0">
                    <TextBlock Text="Zeile " Foreground="#BDC3C7"/>
                    <TextBlock Text="{Binding CursorLine}" Foreground="#BDC3C7"/>
                    <TextBlock Text=", Spalte " Foreground="#BDC3C7"/>
                    <TextBlock Text="{Binding CursorColumn}" Foreground="#BDC3C7"/>
                </StackPanel>
                
                <ProgressBar Grid.Column="2" 
                             IsIndeterminate="True" 
                             Width="100" Height="8"
                             Visibility="{Binding IsCompiling, Converter={StaticResource BoolToVis}}"/>
            </Grid>
        </Border>
    </Grid>
</Window>
